<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="icon" href="./magic8ball_logo.ico"/>
<title>Magic 8 Ball</title>
<style>
  :root{--bg:#0b0f14;--ball:#0b0b0b;--glass:#0a3a66;--tri:#0a5ea8;--text:#f3fbff}
  html,body{height:100%;margin:0;padding:0;overflow:hidden;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#021428 0%, #041726 60%);color:var(--text)}
  .scene{width:360px;max-width:92vw;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}
  .ball{
    width:360px;height:360px;border-radius:50%;background:radial-gradient(circle at 30% 20%, #292f36 0%, #000 45%);box-shadow:0 10px 30px rgba(2,6,12,0.8), inset 0 -6px 18px rgba(0,0,0,0.6);
    position:relative;display:flex;align-items:center;justify-content:center;margin:0 auto;
    transform-origin:center center;
    transition:transform .35s ease-out;
    cursor:pointer;
  }
  .gloss{position:absolute;left:18%;top:16%;width:36%;height:18%;border-radius:40%;background:linear-gradient(180deg, rgba(255,255,255,0.24), rgba(255,255,255,0.02));transform:rotate(-18deg);filter:blur(0.8px);opacity:0.85}
  .triangle{ 
    width:0;height:0;border-left:64px solid transparent;border-right:64px solid transparent;border-top:110px solid var(--tri);
    position:relative;
    transform:translateY(10px);
  }
  .answer{
    position:absolute;
    top:-110px;
    left:-50px;
    width:100px; 
    max-height:85px;
    text-align:center;
    color:white;
    font-weight:600;
    font-size:12px;
    line-height:1.2;
    font-family: 'Segoe UI', Roboto, system-ui, -apple-system;
    pointer-events:none;
    overflow:hidden;
    word-wrap:break-word;
    word-break:break-word;
    hyphens:auto;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:8px 5px 5px 5px;
    box-sizing:border-box;
  }
  .controls{display:flex;gap:10px;justify-content:center;margin-top:18px;flex-wrap:wrap}
  button{background:#0a74c2;border:none;color:white;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 14px rgba(10,90,150,0.18);margin:2px}
  button:active{transform:translateY(2px)}
  button.reset{background:#c20a0a}
  .hint{color:#b8d6ff;text-align:center;margin-top:10px;font-size:13px}
  .small{font-size:12px;color:#a8c7e8;margin-top:6px;text-align:center}
  input[type="text"]{width:220px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text);margin:2px}
  input::placeholder{color:#7a9bc4}
  footer{margin-top:14px;text-align:center;font-size:12px;color:#97b7da}
  .input-group{display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap}
  .shake-indicator{position:absolute;top:20px;left:50%;transform:translateX(-50%);color:#7a9bc4;font-size:12px;opacity:0;transition:opacity 0.3s}
  .shake-indicator.show{opacity:1}
  
  @media (max-width:420px){
    .ball{width:72vw;height:72vw}
    .triangle{border-left:9vw solid transparent;border-right:9vw solid transparent;border-top:15vw solid var(--tri)}
    .answer{width:28vw;max-height:18vw;font-size:2.8vw;top:-12.5vw;left:-14vw;line-height:1.2;padding:2vw 1vw 1vw 1vw;align-items:flex-start}
    input[type="text"]{width:80vw;max-width:280px}
    .controls{flex-direction:column;align-items:center}
    .input-group{flex-direction:column;align-items:center}
  }
</style>
</head>
<body>
<div class="scene">
  <div class="shake-indicator" id="shakeIndicator">Shake detected!</div>
  
  <div id="ball" class="ball" role="button" title="Click or shake to get an answer">
    <div class="gloss"></div>
    <div class="triangle" id="triangle">
      <div class="answer" id="answer">ask me anything</div>
    </div>
  </div>

  <div class="input-group">
    <input id="question" type="text" placeholder="Ask me anything and press Enter"/>
  </div>

  <div class="controls">
    <button id="shake">Shake</button>
    <button id="reset" class="reset">Reset List</button>
  </div>

  <div class="input-group">
    <input id="custom" type="text" placeholder="Add custom response and press Enter"/>
  </div>

  <footer>Made by Adam</footer>
</div>

<script>
(() => {
  const answersDefault = [
    "It is certain",
    "Without a doubt",
    "You may rely on it",
    "Yes â€” definitely",
    "As I see it, yes",
    "Most likely",
    "Outlook good",
    "Yes",
    "Signs point to yes",
    "Reply hazy, try again",
    "Ask again later",
    "Better not tell you now",
    "Cannot predict now",
    "Concentrate and ask again",
    "Don't count on it",
    "My reply is no",
    "My sources say no",
    "Outlook not so good",
    "Very doubtful",
    "Absolutely yes"
  ];

  // load custom answers from localStorage or URL param answers= separated by |
  function getURLAnswers(){
    try{
      const p = new URLSearchParams(location.search).get('answers');
      if(p) return decodeURIComponent(p).split('|').filter(Boolean);
    }catch(e){}
    return null;
  }
  const paramAnswers = getURLAnswers();
  let stored = JSON.parse(localStorage.getItem('magic8_answers') || 'null');
  let answers = (paramAnswers && paramAnswers.length>0) ? paramAnswers : (stored && stored.length>0 ? stored : [...answersDefault]);

  const ball = document.getElementById('ball');
  const tri = document.getElementById('triangle');
  const ansEl = document.getElementById('answer');
  const shakeBtn = document.getElementById('shake');
  const resetBtn = document.getElementById('reset');
  const input = document.getElementById('custom');
  const question = document.getElementById('question');
  const shakeIndicator = document.getElementById('shakeIndicator');

  function pick(){
    return answers[Math.floor(Math.random()*answers.length)];
  }
  function show(text){
    ansEl.textContent = text;
  }

  function showShakeIndicator(){
    shakeIndicator.classList.add('show');
    setTimeout(() => {
      shakeIndicator.classList.remove('show');
    }, 2000);
  }

  function doShake(){
    ball.style.transform = 'rotate(-18deg) translateY(-6px) scale(0.99)';
    tri.style.transition = 'transform .6s cubic-bezier(.2,.9,.2,1)';
    tri.style.transform = 'translateY(4px) rotate(-6deg) scale(1)';
    setTimeout(()=> {
      const a = pick();
      show(a);
      ball.style.transform = 'rotate(0deg) translateY(0) scale(1)';
      tri.style.transform = 'translateY(10px) rotate(0) scale(1)';
    }, 600);
  }

  function resetAnswers(){
    answers = [...answersDefault];
    localStorage.removeItem('magic8_answers');
    show('List reset to defaults');
    setTimeout(() => {
      show('ask me anything');
    }, 2000);
  }

  ball.addEventListener('click', doShake);
  shakeBtn.addEventListener('click', doShake);
  resetBtn.addEventListener('click', resetAnswers);

  question.addEventListener('keydown',(e)=>{
    if(e.key==='Enter' && question.value.trim()){
      doShake();
      question.value='';
    }
  });

  input.addEventListener('keydown',(e)=>{
    if(e.key==='Enter'){
      const t = input.value.trim();
      if(t){
        answers.push(t);
        localStorage.setItem('magic8_answers', JSON.stringify(answers));
        show('added: ' + t);
        input.value='';
        setTimeout(() => {
          show('ask me anything');
        }, 2000);
      }
    }
  });

  // Enhanced motion detection for mobile devices
  function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  let motionPermissionGranted = false;

  async function requestMotionPermission() {
    if (!isMobileDevice()) return true;

    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      try {
        const permission = await DeviceOrientationEvent.requestPermission();
        motionPermissionGranted = permission === 'granted';
        if (motionPermissionGranted) {
          setupMotionListeners();
        }
        return motionPermissionGranted;
      } catch (error) {
        console.log('Motion permission denied or failed:', error);
        return false;
      }
    } else {
      // For devices that don't need permission (Android, older iOS)
      motionPermissionGranted = true;
      setupMotionListeners();
      return true;
    }
  }

  function setupMotionListeners() {
    if (!motionPermissionGranted) return;

    let lastTime = 0;
    let lastX = 0, lastY = 0, lastZ = 0;
    let shakeDetected = false;

    window.addEventListener('devicemotion', (event) => {
      const acceleration = event.accelerationIncludingGravity;
      if (!acceleration) return;

      const currentTime = Date.now();
      if (currentTime - lastTime < 100) return; // Throttle to every 100ms

      const x = acceleration.x || 0;
      const y = acceleration.y || 0;
      const z = acceleration.z || 0;

      const deltaX = Math.abs(x - lastX);
      const deltaY = Math.abs(y - lastY);
      const deltaZ = Math.abs(z - lastZ);

      const totalDelta = deltaX + deltaY + deltaZ;

      if (totalDelta > 25 && !shakeDetected) {
        shakeDetected = true;
        showShakeIndicator();
        doShake();
        
        // Reset shake detection after 1 second
        setTimeout(() => {
          shakeDetected = false;
        }, 1000);
      }

      lastX = x;
      lastY = y;
      lastZ = z;
      lastTime = currentTime;
    });
  }

  // Try to request permission immediately on page load
  window.addEventListener('load', () => {
    if (isMobileDevice()) {
      // Small delay to ensure page is fully loaded
      setTimeout(() => {
        requestMotionPermission();
      }, 500);
    }
  });

  // Fallback: request permission on first user interaction if not already granted
  document.addEventListener('click', () => {
    if (isMobileDevice() && !motionPermissionGranted) {
      requestMotionPermission();
    }
  }, { once: true });
})();
</script>
</body>
</html>